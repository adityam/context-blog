<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Metapost and TeX labels" />
<meta property="og:description" content="Using string labels in Metapost" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://adityam.github.io/context-blog/2014/01/metapost-and-tex-labels/" />

  <meta property="og:image" content="https://adityam.github.io/context-blog/2014/images/metapost-labels.png" />



<meta property="article:published_time" content="2014-01-22T19:25:23-07:00"/>
<meta property="article:modified_time" content="2014-01-22T19:25:23-07:00"/>














  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image:src" content="https://adityam.github.io/context-blog/2014/images/metapost-labels.png"/>



<meta name="twitter:text:title" content="Metapost and TeX labels"/>
<meta name="twitter:title" content="Metapost and TeX labels"/>
<meta name="twitter:description" content="Using string labels in Metapost"/>

<meta name="generator" content="Hugo 0.21" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Metapost and TeX labels",
  "image": {
    "@type": "ImageObject",
    "url": "https://adityam.github.io/context-blog/2014/images/metapost-labels.png",
    "height": "44",
    "width": "111"
  },
  "url": "https://adityam.github.io/context-blog/2014/01/metapost-and-tex-labels/",
  "wordCount": "473",
  "datePublished": "2014-01-22T19:25:23-07:00",
  "dateModified": "2014-01-22T19:25:23-07:00",
  "author": {
    "@type": "Person",
    "name": "Aditya Mahajan"
  },
  "keywords": "feature,context,metapost,label",
  "description": "Using string labels in Metapost"
}
</script>



    <link rel="canonical" href="https://adityam.github.io/context-blog/2014/01/metapost-and-tex-labels/">

    <title>Metapost and TeX labels | Random Determinism</title>

    <!-- combined, minified CSS -->
    <link href="https://adityam.github.io/context-blog/css/style.css" rel="stylesheet" integrity="sha384-j3n8sYdzztDYtVc80KiiuOXoCg5Bjz0zYyLGzDMW8RbfA0u5djbF0GO3bVOPoLyN" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="https://adityam.github.io/context-blog/">Home</a>
          
          
        </nav>
      </div>
    </div>

    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="https://adityam.github.io/context-blog/" rel="home">Random Determinism</a></h1>
        <p class="lead blog-description">Random thoughts on ConTeXt</p>
      </div>
    </header>

    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="https://adityam.github.io/context-blog/2014/01/metapost-and-tex-labels/">Metapost and TeX labels</a></h2>
    <p class="blog-post-meta"><time datetime="2014-01-22T19:25:23-07:00">Wed Jan 22, 2014</time> by Aditya Mahajan in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/context-blog/categories/feature" rel="category tag">feature</a>


<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/context-blog/tags/context" rel="tag">context</a>, <a href="/context-blog/tags/metapost" rel="tag">metapost</a>, <a href="/context-blog/tags/label" rel="tag">label</a>

</p>
  </header>
  <p>Default Metapost has the concept of two types of labels, postscript labels and
TeX labels. Postscript labels are created using</p>

<pre><code class="language-metapost">label(&quot;text&quot;, location);
</code></pre>

<p>while TeX labels are created using</p>

<pre><code class="language-metapost">label(btex text etex, location);
</code></pre>

<p>In the latter case,  Metapost collects everything between <code>btex</code> and <code>etex</code> in a
separate file, processes that file through TeX, and includes the resulting
postscript code at an appropriate location. Such a Golberg-esque mechanism is
needed to propertly typeset mathematics, get proper kerning, etc.; tasks that
TeX can do but Postscript cannot.</p>

<p>ConTeXt has always been tightly integrated with Metapost, but in the pdftex
days typesetting labels was slow. ConTeXt (i.e. pdftex) calls Metapost (to
draw a figure, say), and then Metapost calls pdftex (to typeset a label), and
imports the result to the postscript; this postscript file is passed to
ConTeXt and translated into PDF code using TeX macros and the result in
inserted in the PDF file that pdftex is generating. Phew!</p>

<p>Six or seven years ago, Hans Hagen and Mojca Miklavec had an idea to speed up
this process by collecting all the labels at the ConTeXt end, typesetting them
in boxes, and pass on the dimension of the boxes to Metapost. See Mojca’s <a href="http://dl.contextgarden.net/myway/sometxt.pdf">My
Way</a> describing this mechanism. To use this feature, one had to type:</p>

<pre><code class="language-metapost">label(\sometxt{text}, location);
</code></pre>

<p>With luatex, Metapost can be called as a library, and the basic idea of preprocessing the labels at the TeX end and passing the resulting dimensions to Metapost has been implemented more robustly in Lua. (The conversion of the PS generated by Metapost to PDF is also done in Lua). So one could just type</p>

<pre><code class="language-metapost">label(btex text etex, location);
</code></pre>

<p>and ConTeXt would parse the Metapost environment and do all the book-keeping at the back.</p>

<p>However, I had always been unstastified with the user interface. There are
very few situations where I as a user want postscript labels. So, why not
redefine the label macro so that</p>

<pre><code class="language-metapost">label(&quot;text&quot;, location);
</code></pre>

<p>is equivalent to the <code>btex ... etex</code> version. I had made such a suggestion
back in 2007, and for some years had been using a private macro for such
purposes.</p>

<p>Today, while answering a question at <a href="http://tex.stackexchange.com/">TEX.SX</a>, I noticed that <strong>now there is no
difference between the postscript and the TeX labels!</strong>. For example</p>

<pre><code class="language-tex">\setupbodyfont[times]
\starttext
 
\startMPpage[offset=2mm]
  draw &quot;$w$&quot; infont defaultfont scaled defaultscale;
  draw btex $p$ etex shifted (1cm,0);
\stopMPpage
\stoptext
</code></pre>

<p>gives</p>

<p><img src="../../images/metapost-labels.png" alt="Metapost labels" /></p>

<p>Notice that both <code>w</code> and <code>p</code> are in the Times Math font. So, there is no need for
those pesky <code>btex ... etex</code> tags anymore.</p>

<p>I really don’t know when this change was implemented. As far as I can tell,
nothing has changed at the ConTeXt end, so it appears that MetaPost is now
directly parsing the postscript labels using TeX. Nonetheless, this means that
there is one less thing to worry about while learning and using Metapost. Yay!</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fadityam.github.io%2fcontext-blog%2f2014%2f01%2fmetapost-and-tex-labels%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=https%3a%2f%2fadityam.github.io%2fcontext-blog%2f2014%2f01%2fmetapost-and-tex-labels%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fadityam.github.io%2fcontext-blog%2f2014%2f01%2fmetapost-and-tex-labels%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=https%3a%2f%2fadityam.github.io%2fcontext-blog%2f2014%2f01%2fmetapost-and-tex-labels%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 offset-sm-1 blog-sidebar">
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>About</h4>
    <p>A blog about ConTeXt</p>
  </section>
  

  
        <section class="sidebar-module">
    <h4>Recent Posts</h4>
    <ol class="list-unstyled">


<li><a href="/context-blog/2017/06/using-a-static-website--instead-of-wordpress/">Using a static website  instead of wordpress</a></li>

<li><a href="/context-blog/2014/01/metapost-and-tex-labels/">Metapost and TeX labels</a></li>

    </ol>
  </section>

  

  
  <section class="sidebar-module">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="http://wiki.contextgarden.net/Main_Page">Context garden</a></li>
      
      <li><a href="https://tex.stackexchange.com">TeX StackExchange</a></li>
      
    </ol>
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="blog-footer">
      <p>
      
      Except where otherwise noted, content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution 4.0 International license</a>.
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>

  </body>

</html>
