<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Random Determinism</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Aditya Mahajan" />
  <link rel="stylesheet" href="https://adityam.github.io/context-blog/css/styles.css" type="text/css" />
  <link rel="stylesheet" href="https://adityam.github.io/context-blog/css/paperclear.css" type="text/css" />
  
</head>
<body>
  
  
  
  <div id="container">
    <div id="header" role="banner">
      <span id="title"><a href="https://adityam.github.io/context-blog">Random Determinism</a></span><br />
      <span id="sub-title">A Blog about ConTeXt</span>
    </div>
    
    
    
    <div id="menu" role="navigation">
      <ul class="nav tree">
        <li>
        <strong>Recent Posts</strong>
          <ul>
            
            <li><a href="/context-blog/post/formatting-numbers/">Formatting numbers in Lua</a></li>
            
            <li><a href="/context-blog/post/new-metafun-interface/">New Metapost interface</a></li>
            
            <li><a href="/context-blog/post/exam-coverpage/">Designing exam cover page</a></li>
            
            <li><a href="/context-blog/post/setuptex/">Switching between different context versions</a></li>
            
            <li><a href="/context-blog/post/frame-with-solid-left-line-redux/">Frame With Solid Left Line Redux</a></li>
            
          </ul>
        </li>
        <li><strong><a href="https://adityam.github.io/context-blog/post">All Posts</a></strong></li>
      </ul>
    </div>
    
    
    
    <div id="content" role="main">


<h1>Syntax Highlighting engines: Clean TeX output</h1>
<p class="post-time">Posted on June 6, 2011</p>



<p>The vim module uses the vim editor to syntax highlight code snippets in
ConTeXt. I thought that it should be straight forward to support other syntax
highlighting engines: <code>source-highlight</code>, <code>pygments</code>, <code>HsColor</code>, etc. Unfortunately,
that is not the case. None of these syntax highlighting engines were written
with reuse in mind.</p>

<p>For example, consider a simple tex file:</p>
<pre><code>\definestartstop[important]
                [color=red,
                 style=\italic]
\starttext
This is an \important{important} text
\stoptext</code></pre>
<p>Lets compare the tex file generated by various syntax highlighters:</p>

<h2 id="source-highlight">Source Highlight</h2>

<p><code>source-highlight -f latex</code> gives</p>

<!--
```
% Generator: GNU source-highlight, by Lorenzo Bettini, http://www.gnu.org/software/src-highlite
\noindent
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}definestartstop}}\textcolor{Purple}{[important]} \\
 
\mbox{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [color=red, \\
 
\mbox{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ style=\textbf{\textcolor{Blue}{\textbackslash{}italic}}] \\
 
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}starttext}} \\
 
\mbox{}This\ is\ an\ \textbf{\textcolor{Blue}{\textbackslash{}important}}\textcolor{ForestGreen}{\{important\}}\ text \\
 
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}stoptext}} \\
 
\mbox{}
```
-->

<pre><code>% Generator: GNU source-highlight, by Lorenzo Bettini, <a href="http://www.gnu.org/software/src-highlite">http://www.gnu.org/software/src-highlite</a>
<span class="Statement">\noindent</span>
<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}definestartstop}}<span class="Statement">\textcolor</span>{Purple}{[important]} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Special">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span>[color=red, <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Special">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span>style=<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}italic}}] <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}starttext}} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}This<span class="Special">\ </span>is<span class="Special">\ </span>an<span class="Special">\ </span><span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}important}}<span class="Statement">\textcolor</span>{ForestGreen}{<span class="Special">\{</span>important<span class="Special">\}</span>}<span class="Special">\ </span>text <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}stoptext}} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}</code></pre>

<h2 id="pygmentize">Pygmentize</h2>

<p><code>pygmentize -f latex</code> gives</p>

<!--
```
\begin{Verbatim}[commandchars=\\
\{\}]
\PY{k}{\PYZbs{}definestartstop}\PY{n+na}{[important]}
                [color=red,
                 style=\PY{k}{\PYZbs{}italic}]
\PY{k}{\PYZbs{}starttext}
This is an \PY{k}{\PYZbs{}important}\PY{n+nb}{\PYZob{}}important\PY{n+nb}{\PYZcb{}} text
\PY{k}{\PYZbs{}stoptext}
\end{Verbatim}
```
-->

<pre><code><span class="Statement">\begin</span>{Verbatim}[commandchars=<span class="Special">\\</span>
<span class="Special">\{\}</span>]
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}definestartstop}<span class="Statement">\PY</span>{n+na}{[important]}
                [color=red,
                 style=<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}italic}]
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}starttext}
This is an <span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}important}<span class="Statement">\PY</span>{n+nb}{<span class="Statement">\PYZob</span>{}}important<span class="Statement">\PY</span>{n+nb}{<span class="Statement">\PYZcb</span>{}} text
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}stoptext}
<span class="Statement">\end</span>{Verbatim}</code></pre>

<h2 id="hscolor">HsColor</h2>

<p><code>HsColor-latex -partial</code> gives</p>

<!--
```
\textcolor{red}{$\backslash$}{\rm{}definestartstop}\textcolor{red}{[}{\rm{}important}\textcolor{red}{]}\\
\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{[}{\rm{}color}\textcolor{red}{=}{\rm{}red}\textcolor{cyan}{,}\\
\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}style}\textcolor{cyan}{=$\backslash$}{\rm{}italic}\textcolor{red}{]}\\
\textcolor{red}{$\backslash$}{\rm{}starttext}\\
{\rm{}This}\hsspace {\rm{}is}\hsspace {\rm{}an}\hsspace \textcolor{red}{$\backslash$}{\rm{}important}\textcolor{cyan}{\{}{\rm{}important}\textcolor{cyan}{\}}\hsspace {\rm{}text}\\
\textcolor{red}{$\backslash$}{\rm{}stoptext}\\
```
-->

<pre><code><span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}definestartstop}<span class="Statement">\textcolor</span>{red}{[}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{red}{]}<span class="Special">\\</span>
<span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\textcolor</span>{red}{[}{<span class="Statement">\rm</span>{}color}<span class="Statement">\textcolor</span>{red}{=}{<span class="Statement">\rm</span>{}red}<span class="Statement">\textcolor</span>{cyan}{,}<span class="Special">\\</span>
<span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}style}<span class="Statement">\textcolor</span>{cyan}{=<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}italic}<span class="Statement">\textcolor</span>{red}{]}<span class="Special">\\</span>
<span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}starttext}<span class="Special">\\</span>
{<span class="Statement">\rm</span>{}This}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}is}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}an}<span class="Statement">\hsspace</span> <span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{cyan}{<span class="Special">\{</span>}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{cyan}{<span class="Special">\}</span>}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}text}<span class="Special">\\</span>
<span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}stoptext}<span class="Special">\\</span></code></pre>

<p><code>HsColor</code> and <code>source-highlight</code> use explicit LaTeX commands for spacing and formatting. Ouch! <code>pygmentize</code> uses logical markup, but with cryptic command names. But, from the point of view of using <code>pygmentize</code> output in ConTeXt, the <code>\begin{Verbatim}</code> and <code>\end{Verbatim}</code> are show stopper. (OK, not really. It can be bypassed with some effort).</p>

<hr />

<p>Based on this experience, I decided to clean up the output generated by <code>2context.vim</code>:</p>

<!--
```
\SYN[Identifier]{\\definestartstop}[important]
                [color=red,
                 style=\SYN[Identifier]{\\italic}]
\SYN[Statement]{\\starttext}
This is an \SYN[Identifier]{\\important}\{important\} text
\SYN[Statement]{\\stoptext}
```
-->

<pre><code><span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>definestartstop<span class="Delimiter">}[</span>important<span class="Delimiter">]</span>
                <span class="Delimiter">[</span>color=red,
                 style=<span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>italic<span class="Delimiter">}]</span>
<span class="Statement">\SYN</span><span class="Delimiter">[</span>Statement<span class="Delimiter">]{</span><span class="Special">\\</span>starttext<span class="Delimiter">}</span>
This is an <span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>important<span class="Delimiter">}</span><span class="Special">\{</span>important<span class="Special">\}</span> text
<span class="Statement">\SYN</span><span class="Delimiter">[</span>Statement<span class="Delimiter">]{</span><span class="Special">\\</span>stoptext<span class="Delimiter">}</span></code></pre>

<p>I assume only four TeX commands to be defined: <code>\</code>, <code>\{</code>, and <code>\}</code> for
backslash, open brace, and close brace; and <code>\SYN[...]{...}</code> for syntax
highlighting. Thus, if anyone wants to reuse <code>2context.vim</code> in plain TeX or
LaTeX, or a yet to be written future macro package, they would not need to
modify the output at all. I wish the other syntax highlighting programs did
the same.</p>


<hr />

<p class="nav">

<a href="/context-blog/post/tex-programming/">&nbsp;&lt;TeX Programming</a>


| <a href="/context-blog/post/lower-learning-curve/">Lowering the learning curve for TeX></a>

</p>

<p>
This entry was posted in 

<a href="https://adityam.github.io/context-blog/categories/formatting">
  Formatting</a> 
and tagged 

<a href="https://adityam.github.io/context-blog/tags/t-vim">t-vim</a>,
<a href="https://adityam.github.io/context-blog/tags/code-formatting">code formatting</a>.
 
</p>

<div id="disqus_thread"></div>
<div id="disqus_comments">
  <button onclick="load_disqus()">Show Comments</button>
</div>
<script>
    function load_disqus() { 
        var d = document, s = d.createElement('script');
        s.src = '//random-determinism.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        var load_button = document.getElementById('disqus_comments');
        load_button.parentNode.removeChild(load_button);
    };
   (function () {
        var d = document, s = d.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//random-determinism.disqus.com/count.js';
        (d.head || d.body).appendChild(s);
    }()); 
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




    </div>
    
    
    
    <div id="pied" role="contentinfo">
      Content distributed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a> license
    </div>
  </div>
</body>
</html>


