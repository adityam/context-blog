---
title     : "Syntax Highlighting engines: Clean TeX output"
linktitle : "Clean TeX output"
date  : 2011-06-06
tags  :
  - code formatting
categories :
  - t-vim 
---

The vim module uses the vim editor to syntax highlight code snippets in
ConTeXt. I thought that it should be straight forward to support other syntax
highlighting engines: `source-highlight`, `pygments`, `HsColor`, etc. Unfortunately,
that is not the case. None of these syntax highlighting engines were written
with reuse in mind.

<!--more-->

For example, consider a simple tex file:

```
\definestartstop[important]
                [color=red,
                 style=\italic]
\starttext
This is an \important{important} text
\stoptext
```

Lets compare the tex file generated by various syntax highlighters:

## Source Highlight

`source-highlight -f latex` gives

<!--
```
% Generator: GNU source-highlight, by Lorenzo Bettini, http://www.gnu.org/software/src-highlite
\noindent
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}definestartstop}}\textcolor{Purple}{[important]} \\
 
\mbox{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [color=red, \\
 
\mbox{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ style=\textbf{\textcolor{Blue}{\textbackslash{}italic}}] \\
 
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}starttext}} \\
 
\mbox{}This\ is\ an\ \textbf{\textcolor{Blue}{\textbackslash{}important}}\textcolor{ForestGreen}{\{important\}}\ text \\
 
\mbox{}\textbf{\textcolor{Blue}{\textbackslash{}stoptext}} \\
 
\mbox{}
```
-->

<pre><code>% Generator: GNU source-highlight, by Lorenzo Bettini, <a href="http://www.gnu.org/software/src-highlite">http://www.gnu.org/software/src-highlite</a>
<span class="Statement">\noindent</span>
<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}definestartstop}}<span class="Statement">\textcolor</span>{Purple}{[important]} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Special">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span>[color=red, <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Special">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span>style=<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}italic}}] <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}starttext}} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}This<span class="Special">\ </span>is<span class="Special">\ </span>an<span class="Special">\ </span><span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}important}}<span class="Statement">\textcolor</span>{ForestGreen}{<span class="Special">\{</span>important<span class="Special">\}</span>}<span class="Special">\ </span>text <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}<span class="Statement">\textbf</span>{<span class="Statement">\textcolor</span>{Blue}{<span class="Statement">\textbackslash</span>{}stoptext}} <span class="Special">\\</span>

<span class="Statement">\mbox</span>{}</code></pre>

## Pygmentize

`pygmentize -f latex` gives

<!--
```
\begin{Verbatim}[commandchars=\\
\{\}]
\PY{k}{\PYZbs{}definestartstop}\PY{n+na}{[important]}
                [color=red,
                 style=\PY{k}{\PYZbs{}italic}]
\PY{k}{\PYZbs{}starttext}
This is an \PY{k}{\PYZbs{}important}\PY{n+nb}{\PYZob{}}important\PY{n+nb}{\PYZcb{}} text
\PY{k}{\PYZbs{}stoptext}
\end{Verbatim}
```
-->

<pre><code><span class="Statement">\begin</span>{Verbatim}[commandchars=<span class="Special">\\</span>
<span class="Special">\{\}</span>]
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}definestartstop}<span class="Statement">\PY</span>{n+na}{[important]}
                [color=red,
                 style=<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}italic}]
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}starttext}
This is an <span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}important}<span class="Statement">\PY</span>{n+nb}{<span class="Statement">\PYZob</span>{}}important<span class="Statement">\PY</span>{n+nb}{<span class="Statement">\PYZcb</span>{}} text
<span class="Statement">\PY</span>{k}{<span class="Statement">\PYZbs</span>{}stoptext}
<span class="Statement">\end</span>{Verbatim}</code></pre>

## HsColor

`HsColor-latex -partial` gives

<!--
```
\textcolor{red}{$\backslash$}{\rm{}definestartstop}\textcolor{red}{[}{\rm{}important}\textcolor{red}{]}\\
\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{[}{\rm{}color}\textcolor{red}{=}{\rm{}red}\textcolor{cyan}{,}\\
\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}style}\textcolor{cyan}{=$\backslash$}{\rm{}italic}\textcolor{red}{]}\\
\textcolor{red}{$\backslash$}{\rm{}starttext}\\
{\rm{}This}\hsspace {\rm{}is}\hsspace {\rm{}an}\hsspace \textcolor{red}{$\backslash$}{\rm{}important}\textcolor{cyan}{\{}{\rm{}important}\textcolor{cyan}{\}}\hsspace {\rm{}text}\\
\textcolor{red}{$\backslash$}{\rm{}stoptext}\\
```
-->

<pre><code><span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}definestartstop}<span class="Statement">\textcolor</span>{red}{[}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{red}{]}<span class="Special">\\</span>
<span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\textcolor</span>{red}{[}{<span class="Statement">\rm</span>{}color}<span class="Statement">\textcolor</span>{red}{=}{<span class="Statement">\rm</span>{}red}<span class="Statement">\textcolor</span>{cyan}{,}<span class="Special">\\</span>
<span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> <span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}style}<span class="Statement">\textcolor</span>{cyan}{=<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}italic}<span class="Statement">\textcolor</span>{red}{]}<span class="Special">\\</span>
<span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}starttext}<span class="Special">\\</span>
{<span class="Statement">\rm</span>{}This}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}is}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}an}<span class="Statement">\hsspace</span> <span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{cyan}{<span class="Special">\{</span>}{<span class="Statement">\rm</span>{}important}<span class="Statement">\textcolor</span>{cyan}{<span class="Special">\}</span>}<span class="Statement">\hsspace</span> {<span class="Statement">\rm</span>{}text}<span class="Special">\\</span>
<span class="Statement">\textcolor</span>{red}{<span class="String">$</span><span class="Statement">\backslash</span><span class="String">$</span>}{<span class="Statement">\rm</span>{}stoptext}<span class="Special">\\</span></code></pre>

`HsColor` and `source-highlight` use explicit LaTeX commands for spacing and formatting. Ouch! `pygmentize` uses logical markup, but with cryptic command names. But, from the point of view of using `pygmentize` output in ConTeXt, the `\begin{Verbatim}` and `\end{Verbatim}` are show stopper. (OK, not really. It can be bypassed with some effort).

---

Based on this experience, I decided to clean up the output generated by `2context.vim`:

<!--
```
\SYN[Identifier]{\\definestartstop}[important]
                [color=red,
                 style=\SYN[Identifier]{\\italic}]
\SYN[Statement]{\\starttext}
This is an \SYN[Identifier]{\\important}\{important\} text
\SYN[Statement]{\\stoptext}
```
-->

<pre><code><span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>definestartstop<span class="Delimiter">}[</span>important<span class="Delimiter">]</span>
                <span class="Delimiter">[</span>color=red,
                 style=<span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>italic<span class="Delimiter">}]</span>
<span class="Statement">\SYN</span><span class="Delimiter">[</span>Statement<span class="Delimiter">]{</span><span class="Special">\\</span>starttext<span class="Delimiter">}</span>
This is an <span class="Statement">\SYN</span><span class="Delimiter">[</span>Identifier<span class="Delimiter">]{</span><span class="Special">\\</span>important<span class="Delimiter">}</span><span class="Special">\{</span>important<span class="Special">\}</span> text
<span class="Statement">\SYN</span><span class="Delimiter">[</span>Statement<span class="Delimiter">]{</span><span class="Special">\\</span>stoptext<span class="Delimiter">}</span></code></pre>

I assume only four TeX commands to be defined: `\`, `\{`, and `\}` for
backslash, open brace, and close brace; and `\SYN[...]{...}` for syntax
highlighting. Thus, if anyone wants to reuse `2context.vim` in plain TeX or
LaTeX, or a yet to be written future macro package, they would not need to
modify the output at all. I wish the other syntax highlighting programs did
the same.
